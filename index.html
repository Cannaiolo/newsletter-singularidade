<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Guardiões da SINGULARIDADE — Realidade Programada</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Open Graph / WhatsApp thumbnail -->
  <link rel="image_src" href="https://images2.imgbox.com/43/dc/0Sz1QYww_o.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://cannaiolo.github.io/newsletter-singularidade" />
  <meta property="og:title" content="Guardiões da SINGULARIDADE — Realidade Programada" />
  <meta property="og:description" content="As principais notícias de IA, geopolítica e inovação em um só lugar." />
  <meta property="og:image" content="https://images2.imgbox.com/43/dc/0Sz1QYww_o.png" />

  <style>
    @keyframes fade-in { from { opacity:0; transform:translateY(1rem) } to { opacity:1; transform:translateY(0) } }
    .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
    @keyframes blink-fade {
      0%,20%   { background-color: rgba(253,224,71,1); }
      20%,40%  { background-color: rgba(253,224,71,0); }
      40%,60%  { background-color: rgba(253,224,71,1); }
      60%,80%  { background-color: rgba(253,224,71,0); }
      80%,100% { background-color: rgba(253,224,71,0); }
    }
    .animate-blink-fade { animation: blink-fade 5s ease-out forwards; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4">
  <div class="max-w-3xl mx-auto">
    <img src="https://images2.imgbox.com/43/dc/0Sz1QYww_o.png"
         alt="Logo Guardiões da Singularidade"
         class="mx-auto w-40 mb-6">

    <h1 id="page-title" class="text-3xl font-bold text-center mb-1">
      Guardiões da SINGULARIDADE — Realidade Programada
    </h1>
    <p id="page-subtitle" class="text-center text-gray-600 text-lg mb-6">
      A news da sua Segunda-feira
    </p>

    <section id="sumario" class="mb-10">
      <h2 class="text-xl font-semibold mb-2">Tópicos desta edição:</h2>
      <ul id="lista-sumario" class="list-disc pl-5 space-y-2"></ul>
    </section>

    <div id="noticias" class="space-y-10"></div>
  </div>

  <script type="module">
    // --- configuração de edição e títulos ---
    const params = new URLSearchParams(location.search);
    const edicao = params.get('ed') || '2025-07-21_realidade-programada';
    const titleMap = {
      '2025-07-14_entre_vozes_e_algoritmos': 'Entre vozes e algoritmos',
      '2025-07-21_realidade-programada': 'Realidade Programada'
    };

    // --- mapa de sons por notícia ---
    const sounds = {
      'noticia-0': new Audio('/sounds/crypto.mp3'),      // por exemplo
      'noticia-1': new Audio('/sounds/mira.mp3'),
      // adicione mais: 'noticia-2': new Audio('/sounds/chips.mp3'), etc
    };

    import(`./editions/${edicao}.js`)
      .then(mod => {
        const data = mod.default;
        const tema = titleMap[edicao] || edicao;
        document.title = `Guardiões da SINGULARIDADE — ${tema}`;
        document.getElementById('page-title').textContent =
          `Guardiões da SINGULARIDADE — ${tema}`;
        renderNoticias(data);
      })
      .catch(err => {
        console.error("Erro ao carregar edição:", err);
        document.getElementById('noticias').innerHTML =
          '<p class="text-red-600">Não foi possível carregar a edição.</p>';
      });

    function renderNoticias(data) {
      const sumarioEl = document.getElementById('lista-sumario');
      const noticiasEl = document.getElementById('noticias');
      sumarioEl.innerHTML = '';
      noticiasEl.innerHTML = '';

      data.blocos.forEach((noticia, i) => {
        const id = `noticia-${i}`;

        // --- SUMÁRIO ---
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `#${id}`;
        a.textContent = noticia.titulo;
        a.className = 'text-blue-600 hover:underline';
        a.setAttribute('aria-label', `Ir para ${noticia.titulo}`);
        li.appendChild(a);
        sumarioEl.appendChild(li);

        // --- Evento de clique: som + destaque + scroll ---
        a.addEventListener('click', e => {
          e.preventDefault();
          const card = document.getElementById(id);

          // 1) tocar som, se existir
          const snd = sounds[id];
          if (snd) { snd.currentTime = 0; snd.play(); }

          // 2) animação de destaque
          card.classList.remove('animate-blink-fade');
          void card.offsetWidth; 
          card.classList.add('animate-blink-fade');

          // 3) scroll suave
          card.scrollIntoView({ behavior: 'smooth', block: 'start' });
          history.replaceState(null, '', `#${id}`);
        });

        // --- CARD DE NOTÍCIA ---
        const card = document.createElement('div');
        card.id = id;
        card.className =
          'bg-white rounded-2xl shadow p-4 transition-transform hover:scale-[1.02] opacity-0 animate-fade-in';
        card.innerHTML = `
          <h2 class="text-xl font-semibold mb-2">${noticia.titulo}</h2>
          <p class="text-gray-700 mb-2">${noticia.resumo}</p>
          <a href="${noticia.link}"
             target="_blank"
             class="inline-block text-indigo-600 font-medium hover:underline py-2"
             aria-label="Leia mais sobre ${noticia.titulo}">
            Leia mais →
          </a>
        `;
        noticiasEl.appendChild(card);
      });
    }
  </script>
</body>
</html>
